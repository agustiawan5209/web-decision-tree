import{K as te,r as g,j as e}from"./app-TSYLOfGo.js";import{D as le,f as re,a as ne,c as ie,d as oe}from"./dialog-C1s-JYrP.js";import{I as b}from"./input-f--SAutY.js";import{L as k}from"./label-FQFUKQUs.js";import{S as me,a as ce,b as ue,c as de,f as ge}from"./select-BdXchkXm.js";import{T as he}from"./use-mobile-navigation-J1Bz5xez.js";import{D as xe}from"./decision-tree-model-CzIb8K4S.js";import{I as T}from"./input-error-CUJ1Dss0.js";import{B as O}from"./proxy-TbOm_buQ.js";import{L as Y}from"./loader-circle-C1u9jj0m.js";import{L as pe}from"./leafy-green-CT-BMrqA.js";const Ie=({data:i,setData:u,processing:x,errors:w,kriteria:p,setResult:D,setFeature:L,submit:q})=>{const{auth:A}=te().props,[_,y]=g.useState(!1),[fe,U]=g.useState(null),[v]=g.useState(new xe),[H,F]=g.useState(!1),[o,J]=g.useState(null),[R,V]=g.useState(!1),I=new Date;I.toISOString().split("T")[0];const[C,f]=g.useState({title:"",show:!1,message:"",type:"success"}),z=a=>{const{value:s}=a.target,l=p.findIndex(n=>n.nama.toLowerCase().includes("umur"));u(n=>{var t;const r=Z(s);return{...n,tanggal_lahir:s,kriteria:(t=n.kriteria)==null?void 0:t.map((m,c)=>c===l?{...m,nilai:r.toString()}:m)}})},G=g.useCallback(a=>{const{name:s,value:l}=a.target,[n,r]=s.split("."),t=Number(r);n==="kriteria"?(l===""||/^-?\d*\.?\d*$/.test(l))&&u(m=>{var S,E,P;const c=(S=m.kriteria)==null?void 0:S.map((d,B)=>B===t?{...d,nilai:l}:d),h=p.findIndex(d=>d.nama.includes("BB")),j=p.findIndex(d=>d.nama.includes("TB")),N=p.findIndex(d=>d.nama.toLowerCase().includes("imt"));if((t===h||t===j)&&N!==-1){const d=Number(t===h?l:((E=c==null?void 0:c[h])==null?void 0:E.nilai)??0),B=Number(t===j?l:((P=c==null?void 0:c[j])==null?void 0:P.nilai)??0);if(d>0&&B>0)return{...m,kriteria:c==null?void 0:c.map(($,se)=>se===N?{...$,nilai:ae(d,B)}:$)}}return{...m,kriteria:c}}):u(m=>({...m,[s]:l}))},[p,u]);g.useCallback((a,s)=>{const l=Number(a);u(n=>{var r;return{...n,kriteria:(r=n.kriteria)==null?void 0:r.map((t,m)=>m===l?{...t,nilai:s}:t)}})},[u]),g.useEffect(()=>{(async()=>{y(!0);try{const s=await v.fetchAndProcessData();await v.loadModel(),U(s)}catch(s){f({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Nutrisi Anak`,type:"error"}),V(!0)}finally{y(!1)}})()},[]);const K=async a=>{var s,l;a.preventDefault(),y(!0);try{const n=(s=i.kriteria)==null?void 0:s.map(r=>{console.log(r);const t=r.nilai;(t==null||t===""||i.rme==="")&&f({title:"Error",show:!0,message:"Nilai No.RME, jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const m=String(t).toLowerCase();return m==="laki-laki"?0:m==="perempuan"?1:!isNaN(parseFloat(t))&&isFinite(t)?parseFloat(t):t});if(i.nik===""||i.rme===""&&A.role=="admin"||i.nama===""||i.orang_tua_id===""||i.tempat_lahir==="")f({title:"Error",show:!0,message:"NIK, RME, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const r=await v.predict([n??[]]);r.error?f({title:"Hasil Prediksi",show:!0,message:r.error,type:"success"}):(J(r),L&&L(i.kriteria),r.label!==void 0&&r.label!==null&&(u({...i,label:r.label.toString()??"tidak dikenali"}),u({...i,rekomendasi:((l=r.rekomendasi)==null?void 0:l.toString())??"tidak dikenali"}),D&&D(r),Q()))}}catch(n){console.error(n),f({title:"Hasil Prediksi",show:!0,message:n,type:"success"})}finally{y(!1)}},Q=()=>{F(!0)},M=new Date(I);M.setFullYear(I.getFullYear()-1);const W=M.toISOString().split("T")[0];function X(a){const s=new Date(a),l=new Date;let n=l.getFullYear()-s.getFullYear(),r=l.getMonth()-s.getMonth(),t=l.getDate()-s.getDate();return t<0&&(r--,t+=new Date(l.getFullYear(),l.getMonth(),0).getDate()),r<0&&(n--,r+=12),`${n} tahun, ${r} bulan, ${t} hari`}function Z(a){const s=new Date(a),l=new Date;let n=l.getFullYear()-s.getFullYear(),r=l.getMonth()-s.getMonth(),t=l.getDate()-s.getDate(),m=n*12+r;return t<0&&(m-=1),m.toString()}const ee=g.useMemo(()=>{if(!o)return"";switch(o.label){case"Buruk":return"bg-red-100 border-red-300 text-red-800";case"Cukup":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"Baik":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[o]),ae=(a,s)=>{const l=s/100;return(a/(l*l)).toFixed(3)};return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[e.jsx(he,{open:C.show,onOpenChange:()=>f(a=>({...a,show:!1})),title:C.title,description:C.message,duration:1e4,variant:C.type}),e.jsxs("div",{className:"grid grid-cols-1 overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm",children:[e.jsx("div",{className:"p-6 ring-1 md:p-8",children:e.jsxs("form",{onSubmit:a=>K(a),className:"space-y-6",children:[e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"nik",children:"NIK"}),e.jsx(b,{id:"nik",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nik",value:i.nik,onChange:a=>u({...i,nik:a.target.value}),disabled:x,placeholder:"Masukkan Nik Balita"}),e.jsx(T,{message:w.nik,className:"mt-2"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"nama",children:"Nama Balita/Anak"}),e.jsx(b,{id:"nama",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nama",value:i.nama,onChange:a=>u({...i,nama:a.target.value}),disabled:x,placeholder:"Nama Balita/Anak"}),e.jsx(T,{message:w.nama,className:"mt-2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"col-span-1 grid gap-2",children:[e.jsx(k,{htmlFor:"tempat_lahir",children:"Tempat"}),e.jsx(b,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:i.tempat_lahir,onChange:a=>u({...i,tempat_lahir:a.target.value}),disabled:x,placeholder:"tempat_lahir......."}),e.jsx(T,{message:w.tempat_lahir})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(k,{htmlFor:"tanggal_lahir",children:"Tanggal Lahir"}),e.jsx(b,{id:"tanggal_lahir",type:"date",required:!0,max:W,tabIndex:2,autoComplete:"tanggal_lahir",value:i.tanggal_lahir,onChange:a=>z(a),disabled:x,placeholder:"tanggal lahir......."}),e.jsx(T,{message:w.tanggal_lahir})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:p.map((a,s)=>{var n,r,t,m;const l=((r=(n=i.kriteria)==null?void 0:n[s])==null?void 0:r.nilai)??"";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-medium text-gray-700",children:a.nama.charAt(0).toUpperCase()+a.nama.slice(1)}),a.nama.toLowerCase()==="jenis kelamin"?e.jsxs(me,{value:((m=(t=i.kriteria)==null?void 0:t[s])==null?void 0:m.nilai)||"",required:!0,onValueChange:c=>{u(h=>{var j;return{...h,jenis_kelamin:c,kriteria:(j=h.kriteria)==null?void 0:j.map((N,S)=>S===s?{...N,nilai:c}:N)}})},children:[e.jsx(ce,{className:"w-full",children:e.jsx(ue,{placeholder:"Select Jenis Kelamin"})}),e.jsx(de,{children:["Laki-laki","Perempuan"].map((c,h)=>e.jsx(ge,{value:c,children:c},h))})]}):e.jsx(b,{type:"text",name:`kriteria.${s}`,value:l,onChange:G,placeholder:`Enter ${a.nama}`,disabled:x,readOnly:a.nama.toLowerCase().includes("imt")||a.nama.toLowerCase().includes("umur"),required:!0})]},s)})}),e.jsx("div",{className:"flex flex-wrap gap-3 pt-4",children:e.jsxs(O,{type:"submit",disabled:_||!v||R,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",children:[_?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Mulai Pemeriksaan Nutrisi"]})})]})}),e.jsxs(le,{open:H,onOpenChange:F,children:[e.jsx(re,{}),e.jsxs(ne,{className:"max-w-md",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center gap-3 text-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(pe,{className:`h-4 w-4 ${(o==null?void 0:o.label)=="Baik"?"text-green-500":"text-red-500"}`})}),e.jsx("span",{className:"text-lg font-medium",children:"Hasil Pemeriksaan Nutrisi"})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama Anak"}),e.jsx("p",{className:"text-sm font-medium",children:i.nama})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Tanggal Lahir"}),e.jsx("p",{className:"text-sm font-medium",children:i.tanggal_lahir})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Usia"}),e.jsx("p",{className:"text-sm font-medium",children:X(i.tanggal_lahir)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground "+ee,children:"Status Nutrisi"}),e.jsx("p",{className:`h-auto w-max flex-shrink-0 rounded-full px-2 ${(o==null?void 0:o.label)==="Buruk"?"bg-red-500":(o==null?void 0:o.label)==="Cukup"?"bg-yellow-500":(o==null?void 0:o.label)==="Baik"?"bg-green-500":"bg-blue-500"}`,children:o==null?void 0:o.label})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Jenis Sayuran"}),e.jsx("p",{className:"text-sm font-medium",children:o==null?void 0:o.rekomendasi})]})]}),e.jsx(oe,{className:"mt-6",children:e.jsxs(O,{type:"button",variant:"default",size:"sm",className:"w-full",disabled:x,onClick:q,children:[x?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Simpan"]})})]})]})]})]})};export{Ie as C};

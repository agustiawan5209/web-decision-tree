import{K as we,r as m,b as k,j as e}from"./app-CX4-Pmd9.js";import{D as ve,f as Se,a as Ce,c as Be}from"./dialog-WugDzM-3.js";import{I as N}from"./input-D-Ak2e3P.js";import{L as b}from"./label-rPUQY25-.js";import{S as _e,a as Ie,b as Te,c as Le,d as Fe}from"./select-CEaesvqK.js";import{T as De}from"./use-mobile-navigation-BXXCB25s.js";import{D as Ee}from"./decision-tree-model-5iOPiWva.js";import{i as Me,S as Ge}from"./react-select-animated.esm-nlWBVFuC.js";import{I as T}from"./input-error-DEhxppXK.js";import{T as Pe}from"./table-dataset-sayuran-DYnHh7eT.js";import{a as $e,B as D}from"./proxy-CIeOT91w.js";import{L as K}from"./loader-circle-BAxM_9Fy.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M2 22c1.25-.987 2.27-1.975 3.9-2.2a5.56 5.56 0 0 1 3.8 1.5 4 4 0 0 0 6.187-2.353 3.5 3.5 0 0 0 3.69-5.116A3.5 3.5 0 0 0 20.95 8 3.5 3.5 0 1 0 16 3.05a3.5 3.5 0 0 0-5.831 1.373 3.5 3.5 0 0 0-5.116 3.69 4 4 0 0 0-2.348 6.155C3.499 15.42 4.409 16.712 4.2 18.1 3.926 19.743 3.014 20.732 2 22",key:"1134nt"}],["path",{d:"M2 22 17 7",key:"1q7jp2"}]],qe=$e("LeafyGreen",Oe),ea=({data:u,setData:d,processing:p,errors:w,kriteria:f,setResult:V,setFeature:E,submit:H})=>{const{auth:z}=we().props,[M,v]=m.useState(!1),[Ae,J]=m.useState(null),[S]=m.useState(new Ee),[R,G]=m.useState(!1),[c,Q]=m.useState(null),[W,X]=m.useState(!1),P=new Date,[L,Z]=m.useState([]),[ee,ae]=m.useState([]),[te,se]=m.useState([]),[C,le]=m.useState(""),[B,g]=m.useState({title:"",show:!1,message:"",type:"success"}),re=m.useCallback(a=>{const{value:t}=a.target,s=f.findIndex(o=>o.nama.toLowerCase().includes("umur")),i=q(t);$(Number(Number(i)/12).toFixed(1)),d(o=>{var l;return{...o,tanggal_lahir:t,kriteria:(l=o.kriteria)==null?void 0:l.map((r,n)=>n===s?{...r,nilai:i.toString()}:r)}})},[u,d]),ne=m.useCallback(a=>{const{name:t,value:s}=a.target,[i,o]=t.split("."),l=Number(o);i==="kriteria"?(s===""||/^-?\d*\.?\d*$/.test(s))&&d(r=>{var _,A,Y;const n=(_=r.kriteria)==null?void 0:_.map((h,I)=>I===l?{...h,nilai:s}:h),x=f.findIndex(h=>h.nama.includes("BB")),j=f.findIndex(h=>h.nama.includes("TB")),y=f.findIndex(h=>h.nama.toLowerCase().includes("imt"));if((l===x||l===j)&&y!==-1){const h=Number(l===x?s:((A=n==null?void 0:n[x])==null?void 0:A.nilai)??0),I=Number(l===j?s:((Y=n==null?void 0:n[j])==null?void 0:Y.nilai)??0);if(h>0&&I>0)return{...r,kriteria:n==null?void 0:n.map((U,Ne)=>Ne===y?{...U,nilai:fe(h,I)}:U)}}return{...r,kriteria:n}}):d(r=>({...r,[t]:s}))},[f,d]),ie=async a=>{try{const t=await k.get(route("api.get.label-sayuran-by-label",{label:a}));if(t.status!==200)throw new Error("Failed to fetch label sayuran");const s=await t.data;console.log(s),d(i=>({...i,statusGizi:s}))}catch(t){return console.error(t),g({title:"Error",show:!0,message:t.message,type:"error"}),null}},$=async a=>{try{const t=await k.get(route("api.get.klasifikasi-by-usia",{usia:a}));if(t.status!==200)throw new Error("Failed to fetch klasifikasi usia");const s=await t.data;d(i=>({...i,klasifikasiUsia:s}))}catch(t){return console.error(t),g({title:"Error",show:!0,message:t.message,type:"error"}),null}},oe=async()=>{try{const a=await k.get(route("api.get.gejala"));if(a.status!==200)throw new Error("Failed to fetch gejala");const t=await a.data;se(t),Z(t.map(s=>({value:s.nama,label:s.nama})))}catch(a){return console.error(a),g({title:"Error",show:!0,message:a.message,type:"error"}),null}},ce=async(a,t)=>{try{const s=await k.get(route("api.get.dataset.sayuran",{status:a,gejala:t}));if(s.status!==200)throw new Error("Failed to fetch dataset");const i=await s.data;ae(i),d({...u,rekomendasi:i,gejala:t})}catch(s){return console.error(s),g({title:"Error Gejala",show:!0,message:s.message,type:"error"}),null}},ue=async a=>{try{const t=await k.get(route("api.get.balita-by-nik",{user_id:z.user.id,nik:a}));if(t.status!==200)throw new Error("Failed to fetch balita");const s=await t.data;if(s){const i=s.tanggal_lahir||"",o=q(i);$(Number(Number(o)/12).toFixed(1)),d(l=>{var r;return{...l,orang_tua_id:s.orang_tua_id||"",nik:s.nik,nama:s.nama||"",tempat_lahir:s.tempat_lahir||"",tanggal_lahir:i,jenis_kelamin:s.jenis_kelamin,kriteria:(r=l.kriteria)==null?void 0:r.map(n=>n.name.toLowerCase().includes("umur")?{...n,nilai:i?o.toString():""}:n.name.toLowerCase().includes("jenis kelamin")?{...n,nilai:s.jenis_kelamin||""}:n)}})}else g({title:"Peringatan",show:!0,message:`Data balita dengan NIK ${a} tidak ditemukan. Silakan lengkapi data balita secara manual.`,type:"error"})}catch{return g({title:"Peringatan",show:!0,message:`Data balita dengan NIK ${a} tidak ditemukan. Silakan lengkapi data balita secara manual.`,type:"error"}),null}},me=()=>{C.length>=1&&(d(a=>({...a,nik:C})),ue(C))};m.useEffect(()=>{const a=async()=>{v(!0);try{const t=await S.fetchAndProcessData();await S.loadModel(),J(t)}catch(t){g({title:"Error",show:!0,message:`${t.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Nutrisi Anak`,type:"error"}),X(!0)}finally{v(!1)}};oe(),a()},[]);const de=async a=>{var t,s,i;a.preventDefault(),v(!0);try{const o=(t=u.kriteria)==null?void 0:t.map(l=>{const r=l.nilai;(r==null||r==="")&&g({title:"Error",show:!0,message:"Nilai jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const n=String(r).toLowerCase();return n==="laki-laki"?0:n==="perempuan"?1:!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r});if(u.nik===""||u.nama===""||u.orang_tua_id===""||u.tempat_lahir==="")console.log(u.nik,u.nama),g({title:"Error",show:!0,message:"NIK, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const l=await S.predict([o??[]]);if(l.error)g({title:"Hasil Prediksi",show:!0,message:l.error,type:"success"});else if(Q(l),E&&E(u.kriteria),l.label!==void 0&&l.label!==null){const r=l.label.toString();console.log("Setting label to:",r),d(x=>({...x,label:r})),console.log("Data after set (may not be updated yet):",u),V(l);const n=F.join(", ");ce(((s=l.label)==null?void 0:s.toString())??"",n),ie(((i=l.label)==null?void 0:i.toString())??""),ge()}}}catch(o){console.error(o),g({title:"Hasil Prediksi",show:!0,message:o,type:"success"})}finally{v(!1)}};m.useEffect(()=>{c&&c.label&&(console.log("Prediction label changed:",c.label),d("label",c.label.toString()))},[c]);const ge=()=>{G(!0)},O=new Date(P);O.setFullYear(P.getFullYear()-1);const he=O.toISOString().split("T")[0];function xe(a){const t=new Date(a),s=new Date;let i=s.getFullYear()-t.getFullYear(),o=s.getMonth()-t.getMonth(),l=s.getDate()-t.getDate();return l<0&&(o--,l+=new Date(s.getFullYear(),s.getMonth(),0).getDate()),o<0&&(i--,o+=12),`${i} tahun, ${o} bulan, ${l} hari`}function q(a){const t=new Date(a),s=new Date;let i=s.getFullYear()-t.getFullYear(),o=s.getMonth()-t.getMonth(),l=s.getDate()-t.getDate(),r=i*12+o;return l<0&&(r-=1),r.toString()}const pe=m.useMemo(()=>{if(!c)return"";switch(c.label){case"Buruk":return"bg-red-100 border-red-300 text-red-800";case"Cukup":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"Baik":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[c]),fe=(a,t)=>{const s=t/100;return(a/(s*s)).toFixed(3)},[F,je]=m.useState([]),be=m.useMemo(()=>L.filter(a=>F.includes(a.value)),[L,F]),ye=Me(),ke=a=>{const t=a?a.map(s=>s.value):[];je(t)};return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[e.jsx(De,{open:B.show,onOpenChange:()=>g(a=>({...a,show:!1})),title:B.title,description:B.message,duration:1e4,variant:B.type}),e.jsx("div",{className:"grid grid-cols-1 rounded-xl border border-gray-100 bg-white shadow-sm",children:e.jsx("div",{className:"p-6 ring-1 md:p-8",children:e.jsxs("form",{onSubmit:a=>de(a),className:"space-y-6",children:[e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsx(b,{htmlFor:"nik",children:"NIK"}),e.jsxs("div",{className:"flex",children:[e.jsx(N,{id:"nik",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nik",value:C,onChange:a=>{d(t=>({...t,nik:a.target.value})),le(a.target.value)},disabled:p,placeholder:"Masukkan Nik Balita"}),e.jsx(D,{type:"button",variant:"default",onClick:me,children:"Cari"})]}),e.jsx(T,{message:w.nik,className:"mt-2"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"nama",children:"Nama Balita/Anak"}),e.jsx(N,{id:"nama",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nama",value:u.nama,onChange:a=>d({...u,nama:a.target.value}),disabled:p,placeholder:"Nama Balita/Anak"}),e.jsx(T,{message:w.nama,className:"mt-2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"col-span-1 grid gap-2",children:[e.jsx(b,{htmlFor:"tempat_lahir",children:"Tempat"}),e.jsx(N,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:u.tempat_lahir,onChange:a=>d({...u,tempat_lahir:a.target.value}),disabled:p,placeholder:"tempat_lahir......."}),e.jsx(T,{message:w.tempat_lahir})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(b,{htmlFor:"tanggal_lahir",children:"Tanggal Lahir"}),e.jsx(N,{id:"tanggal_lahir",type:"date",required:!0,max:he,tabIndex:2,autoComplete:"tanggal_lahir",value:u.tanggal_lahir,onChange:a=>re(a),disabled:p,placeholder:"tanggal lahir......."}),e.jsx(T,{message:w.tanggal_lahir})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:f.map((a,t)=>{var i,o,l,r;const s=((o=(i=u.kriteria)==null?void 0:i[t])==null?void 0:o.nilai)??"";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-sm font-medium text-gray-700",children:a.nama.charAt(0).toUpperCase()+a.nama.slice(1)}),a.nama.toLowerCase()==="jenis kelamin"?e.jsxs(_e,{value:((r=(l=u.kriteria)==null?void 0:l[t])==null?void 0:r.nilai)||"",required:!0,onValueChange:n=>{d(x=>{var j;return{...x,jenis_kelamin:n,kriteria:(j=x.kriteria)==null?void 0:j.map((y,_)=>_===t?{...y,nilai:n}:y)}})},children:[e.jsx(Ie,{className:"w-full",children:e.jsx(Te,{placeholder:"Select Jenis Kelamin"})}),e.jsx(Le,{children:["Laki-laki","Perempuan"].map((n,x)=>e.jsx(Fe,{value:n,children:n},x))})]}):e.jsx(N,{type:"text",name:`kriteria.${t}`,value:s,onChange:ne,placeholder:`Enter ${a.nama}`,disabled:p,readOnly:a.nama.toLowerCase().includes("imt")||a.nama.toLowerCase().includes("umur"),required:!0})]},t)})}),e.jsx("div",{className:"grid gap-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{className:"",children:[e.jsx(b,{htmlFor:"gejala",children:"Gejala"}),e.jsx(Ge,{id:"gejala",name:"gejala",value:be,onChange:ke,closeMenuOnSelect:!1,components:ye,isMulti:!0,options:L,className:"react-select-container",classNamePrefix:"react-select",tabIndex:4,placeholder:"Pilih gejala..."})]}),e.jsx("div",{className:"",children:e.jsx("ul",{children:te.map(a=>e.jsx("li",{className:"mb-2",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4",children:[e.jsx("h3",{className:"mb-1 font-semibold",children:a.nama}),e.jsx("p",{className:"text-sm text-gray-600",children:a.deskripsi})]})},a.id))})})]})}),e.jsx("div",{className:"flex w-full flex-wrap gap-3 pt-4",children:e.jsxs(D,{type:"submit",disabled:M||!S||W,className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",children:[M?e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Proses"]})})]})})}),e.jsxs(ve,{open:R,onOpenChange:G,children:[e.jsx(Se,{}),e.jsxs(Ce,{className:"h-auto max-w-7xl overflow-y-auto",children:[e.jsx(Be,{children:e.jsxs("div",{className:"flex items-center gap-3 text-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(qe,{className:`h-4 w-4 ${(c==null?void 0:c.label)=="Baik"?"text-green-500":"text-red-500"}`})}),e.jsx("span",{className:"text-lg font-medium",children:"Hasil rekomendasi sayuran"})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama Anak"}),e.jsx("p",{className:"text-sm font-medium",children:u.nama})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Tanggal Lahir"}),e.jsx("p",{className:"text-sm font-medium",children:u.tanggal_lahir})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Usia"}),e.jsx("p",{className:"text-sm font-medium",children:xe(u.tanggal_lahir)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gejala"}),e.jsx("p",{className:"text-sm font-medium",children:u.gejala.split(", ").map((a,t)=>e.jsx("span",{className:"mr-1 mb-1 inline-block rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-800",children:a},t))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground "+pe,children:"status IMT"}),e.jsx("p",{className:`h-auto w-max flex-shrink-0 rounded-full px-2 ${(c==null?void 0:c.label)==="Buruk"?"bg-red-500":(c==null?void 0:c.label)==="Cukup"?"bg-yellow-500":(c==null?void 0:c.label)==="Baik"?"bg-green-500":"bg-blue-500"}`,children:c==null?void 0:c.label})]})]}),e.jsx(Pe,{data:ee}),e.jsxs(D,{type:"button",variant:"default",size:"sm",className:"w-full",disabled:p,onClick:H,children:[p?e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Simpan"]})]})]})]})]})};export{ea as C};

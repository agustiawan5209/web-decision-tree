import{K as R,r as n,m as $,j as e}from"./app-BEqMENVq.js";import{I as F}from"./input-g-ffmoFt.js";import{L as H}from"./label-D7D4h2O7.js";import{S as I,a as A,b as q,c as K,f as V}from"./select-BknL6WGn.js";import{T as J}from"./use-mobile-navigation-Boboy-NT.js";import{D as O}from"./decision-tree-model-C_HzfeSr.js";import{B as v}from"./proxy-CWIQuLMb.js";import{L as N}from"./loader-circle-DJLNHEho.js";const ee=({kriteria:x,setResult:b,setFeature:g,canEvaluate:w=!1})=>{const{auth:f}=R().props,[m,d]=n.useState(!1),[U,k]=n.useState(null),[r]=n.useState(new O),[s,y]=n.useState(null),[p,S]=n.useState(null),{data:u,setData:c,processing:C}=$({label:"",attribut:x.map(()=>"")}),[h,j]=n.useState({title:"",show:!1,message:"",type:"success"}),L=n.useCallback(a=>{const{name:t,value:l}=a.target,i=t.split(".")[1];(l===""||/^-?\d*\.?\d*$/.test(l))&&c(o=>({...o,attribut:o.attribut.map((B,P)=>P===Number(i)?l:B)}))},[c]),D=n.useCallback((a,t)=>{c(a==="label"?l=>({...l,[a]:t}):l=>({...l,attribut:l.attribut.map((i,o)=>o===Number(a)?t:i)}))},[c]);n.useEffect(()=>{(async()=>{d(!0);try{const t=await r.fetchAndProcessData();await r.loadModel(),k(t)}catch(t){console.error(t)}finally{d(!1)}})()},[]);const M=async()=>{d(!0);try{await r.trainModel();const a=await r.evaluateModel();await r.saveModel(),S(a)}catch(a){console.error(a)}finally{d(!1)}},T=async a=>{a.preventDefault(),d(!0);try{const t=u.attribut.map(i=>{const o=String(i).toLowerCase();return o==="laki-laki"?0:o==="perempuan"?1:!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):i}),l=await r.predict([t]);console.log(l),y(l),g&&g(u.attribut),l.label!==void 0&&b&&b({prediction:(s==null?void 0:s.prediction)??0,label:(s==null?void 0:s.label)??"tidak dikenali",rekomendasi:(s==null?void 0:s.rekomendasi)??"Label tidak dikenali",error:(s==null?void 0:s.error)??"Label tidak dikenali"})}catch(t){console.error(t),j({title:"Hasil Prediksi",show:!0,message:t,type:"success"})}finally{d(!1)}};r.getDataLoadingState(),r.getTrainingState(),r.getEvaluationState(),r.getPredictionState();const E=n.useMemo(()=>{if(!s)return"";switch(s.label){case"Buruk":return"bg-red-100 border-red-300 text-red-800";case"Cukup":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"Baik":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[e.jsx(J,{open:h.show,onOpenChange:()=>j(a=>({...a,show:!1})),title:h.title,description:h.message,duration:5e3,variant:h.type}),e.jsxs("div",{className:"grid grid-cols-1 overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm md:grid-cols-2",children:[e.jsx("div",{className:"p-6 ring-1 md:p-8",children:e.jsxs("form",{onSubmit:a=>T(a),className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:x.map((a,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-sm font-medium text-gray-700",children:a.nama.charAt(0).toUpperCase()+a.nama.slice(1)}),a.nama.toLowerCase()==="jenis kelamin"?e.jsxs(I,{value:u.attribut[t]||"",required:!0,onValueChange:l=>D(t.toString(),l),children:[e.jsx(A,{className:"w-full",children:e.jsx(q,{placeholder:"Select Jenis Kelamin"})}),e.jsx(K,{children:["Laki-laki","Perempuan"].map((l,i)=>e.jsx(V,{value:l,children:l},i))})]}):e.jsx(F,{type:"text",name:`attribut.${t}`,value:u.attribut[t]||"",onChange:L,placeholder:`Enter ${a.nama}`,disabled:C,required:!0})]},t))}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",children:[(f.role==="admin"||f.role==="super_admin"&&w)&&e.jsxs(v,{type:"button",variant:"outline",onClick:M,disabled:m,children:[m?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Train Model"]}),e.jsxs(v,{type:"submit",disabled:m||!r,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",children:[m?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Mulai Rekomendasi"]})]})]})}),e.jsxs("div",{className:"p-6 md:p-8",children:[s?e.jsx("div",{className:`border ${E} p-6 transition-all duration-300`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-5 w-5 flex-shrink-0 rounded-full ${s.label==="Buruk"?"bg-red-500":s.label==="Cukup"?"bg-yellow-500":s.label==="Baik"?"bg-green-500":"bg-blue-500"}`}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Hasil Rekomendasi"}),e.jsx("div",{className:"mt-1 text-2xl font-bold",children:s.label})]})]})}):e.jsx("div",{className:"border border-gray-200 p-6 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-5 w-5 flex-shrink-0 rounded-full bg-gray-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Hasil Rekomendasi"}),e.jsx("div",{className:"mt-1 text-2xl font-bold",children:"-"})]})]})}),p&&e.jsx("div",{className:"border p-6 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-5 w-5 flex-shrink-0 rounded-full bg-green-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Hasil Evaluasi Model"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold",children:[p.accuracy*100," %"]})]})]})})]})]})]})};export{ee as F};

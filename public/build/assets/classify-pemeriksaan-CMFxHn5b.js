import{K as Ne,r as d,j as e,b as L}from"./app-p1d1iYTT.js";import{D as ye,f as we,a as ve,c as Ce}from"./dialog-BMN9IYIT.js";import{I as N}from"./input-BaGDxs8C.js";import{L as b}from"./label-Ck9bnV8R.js";import{S as Se,a as _e,b as Be,c as Ie,f as Te}from"./select-BRiKMjMw.js";import{T as De}from"./use-mobile-navigation-BGu3vK2M.js";import{D as Le}from"./decision-tree-model-C2qyoLfC.js";import{i as Me,S as Fe}from"./react-select-animated.esm-D1Z4HCBc.js";import{I}from"./input-error-QLgA3Pc8.js";import{T as Ee}from"./table-dataset-sayuran-DTNa0Z5j.js";import{a as Pe,B as M}from"./proxy-Nz_H2BkD.js";import{L as H}from"./loader-circle-CXfS1Liy.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M2 22c1.25-.987 2.27-1.975 3.9-2.2a5.56 5.56 0 0 1 3.8 1.5 4 4 0 0 0 6.187-2.353 3.5 3.5 0 0 0 3.69-5.116A3.5 3.5 0 0 0 20.95 8 3.5 3.5 0 1 0 16 3.05a3.5 3.5 0 0 0-5.831 1.373 3.5 3.5 0 0 0-5.116 3.69 4 4 0 0 0-2.348 6.155C3.499 15.42 4.409 16.712 4.2 18.1 3.926 19.743 3.014 20.732 2 22",key:"1134nt"}],["path",{d:"M2 22 17 7",key:"1q7jp2"}]],$e=Pe("LeafyGreen",Ge),Xe=({data:i,setData:u,processing:p,errors:y,kriteria:f,setResult:F,setFeature:E,submit:K})=>{const{auth:P}=Ne().props,[G,w]=d.useState(!1),[Oe,R]=d.useState(null),[v]=d.useState(new Le),[z,$]=d.useState(!1),[c,J]=d.useState(null),[Q,W]=d.useState(!1),O=new Date,[T,X]=d.useState([]),[Z,ee]=d.useState([]),[ae,te]=d.useState([]),[C,se]=d.useState(""),[S,h]=d.useState({title:"",show:!1,message:"",type:"success"}),le=a=>{const{value:s}=a.target,t=f.findIndex(l=>l.nama.toLowerCase().includes("umur"));u(l=>{var n;const r=A(s);return{...l,tanggal_lahir:s,kriteria:(n=l.kriteria)==null?void 0:n.map((o,m)=>m===t?{...o,nilai:r.toString()}:o)}})},re=d.useCallback(a=>{const{name:s,value:t}=a.target,[l,r]=s.split("."),n=Number(r);l==="kriteria"?(t===""||/^-?\d*\.?\d*$/.test(t))&&u(o=>{var _,Y,U;const m=(_=o.kriteria)==null?void 0:_.map((g,B)=>B===n?{...g,nilai:t}:g),x=f.findIndex(g=>g.nama.includes("BB")),j=f.findIndex(g=>g.nama.includes("TB")),k=f.findIndex(g=>g.nama.toLowerCase().includes("imt"));if((n===x||n===j)&&k!==-1){const g=Number(n===x?t:((Y=m==null?void 0:m[x])==null?void 0:Y.nilai)??0),B=Number(n===j?t:((U=m==null?void 0:m[j])==null?void 0:U.nilai)??0);if(g>0&&B>0)return{...o,kriteria:m==null?void 0:m.map((V,ke)=>ke===k?{...V,nilai:xe(g,B)}:V)}}return{...o,kriteria:m}}):u(o=>({...o,[s]:t}))},[f,u]),ne=async()=>{try{const a=await L.get(route("api.get.gejala"));if(a.status!==200)throw new Error("Failed to fetch gejala");const s=await a.data;te(s),X(s.map(t=>({value:t.nama,label:t.nama})))}catch(a){return console.error(a),h({title:"Error",show:!0,message:a.message,type:"error"}),null}},ie=async(a,s)=>{try{const t=await L.get(route("api.get.dataset.sayuran",{status:a,gejala:s}));if(t.status!==200)throw new Error("Failed to fetch dataset");const l=await t.data;ee(l),u({...i,rekomendasi:l,gejala:s})}catch(t){return console.error(t),h({title:"Error Gejala",show:!0,message:t.message,type:"error"}),null}},oe=async a=>{try{const s=await L.get(route("api.get.balita-by-nik",{user_id:P.user.id,nik:a}));if(s.status!==200)throw new Error("Failed to fetch balita");const t=await s.data;if(t){console.log(t);const l=t.tanggal_lahir||"";u(r=>{var n;return{...r,orang_tua_id:t.orang_tua_id||"",nik:t.nik,nama:t.nama||"",tempat_lahir:t.tempat_lahir||"",tanggal_lahir:l,jenis_kelamin:t.jenis_kelamin,kriteria:(n=r.kriteria)==null?void 0:n.map(o=>o.name.toLowerCase().includes("umur")?{...o,nilai:l?A(l).toString():""}:o.name.toLowerCase().includes("jenis kelamin")?{...o,nilai:t.jenis_kelamin||""}:o)}})}else h({title:"Peringatan",show:!0,message:`Data balita dengan NIK ${a} tidak ditemukan. Silakan lengkapi data balita secara manual.`,type:"error"})}catch{return h({title:"Peringatan",show:!0,message:`Data balita dengan NIK ${a} tidak ditemukan. Silakan lengkapi data balita secara manual.`,type:"error"}),null}},ce=()=>{C.length>=1&&(u(a=>({...a,nik:C})),oe(C))};d.useEffect(()=>{const a=async()=>{w(!0);try{const s=await v.fetchAndProcessData();await v.loadModel(),R(s)}catch(s){h({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Nutrisi Anak`,type:"error"}),W(!0)}finally{w(!1)}};ne(),a()},[]);const me=async a=>{var s;a.preventDefault(),w(!0);try{const t=(s=i.kriteria)==null?void 0:s.map(l=>{const r=l.nilai;(r==null||r===""||i.rme==="")&&h({title:"Error",show:!0,message:"Nilai No.RME, jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const n=String(r).toLowerCase();return n==="laki-laki"?0:n==="perempuan"?1:!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r});if(i.nik===""||i.rme===""&&P.role=="admin"||i.nama===""||i.orang_tua_id===""||i.tempat_lahir==="")h({title:"Error",show:!0,message:"NIK, RME, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const l=await v.predict([t??[]]);if(l.error)h({title:"Hasil Prediksi",show:!0,message:l.error,type:"success"});else if(J(l),E&&E(i.kriteria),l.label!==void 0&&l.label!==null){if(u({...i,label:l.label.toString()??"tidak dikenali"}),F){F(l);const r=D.join(", ");ie(l.label??"",r)}de()}}}catch(t){console.error(t),h({title:"Hasil Prediksi",show:!0,message:t,type:"success"})}finally{w(!1)}},de=()=>{$(!0)},q=new Date(O);q.setFullYear(O.getFullYear()-1);const ue=q.toISOString().split("T")[0];function ge(a){const s=new Date(a),t=new Date;let l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth(),n=t.getDate()-s.getDate();return n<0&&(r--,n+=new Date(t.getFullYear(),t.getMonth(),0).getDate()),r<0&&(l--,r+=12),`${l} tahun, ${r} bulan, ${n} hari`}function A(a){const s=new Date(a),t=new Date;let l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth(),n=t.getDate()-s.getDate(),o=l*12+r;return n<0&&(o-=1),o.toString()}const he=d.useMemo(()=>{if(!c)return"";switch(c.label){case"Buruk":return"bg-red-100 border-red-300 text-red-800";case"Cukup":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"Baik":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[c]),xe=(a,s)=>{const t=s/100;return(a/(t*t)).toFixed(3)},[D,pe]=d.useState([]),fe=d.useMemo(()=>T.filter(a=>D.includes(a.value)),[T,D]),je=Me(),be=a=>{const s=a?a.map(t=>t.value):[];pe(s)};return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[e.jsx(De,{open:S.show,onOpenChange:()=>h(a=>({...a,show:!1})),title:S.title,description:S.message,duration:1e4,variant:S.type}),e.jsx("div",{className:"grid grid-cols-1 rounded-xl border border-gray-100 bg-white shadow-sm",children:e.jsx("div",{className:"p-6 ring-1 md:p-8",children:e.jsxs("form",{onSubmit:a=>me(a),className:"space-y-6",children:[e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsx(b,{htmlFor:"nik",children:"NIK"}),e.jsxs("div",{className:"flex",children:[e.jsx(N,{id:"nik",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nik",value:C,onChange:a=>se(a.target.value),disabled:p,placeholder:"Masukkan Nik Balita"}),e.jsx(M,{type:"button",variant:"default",onClick:ce,children:"Cari"})]}),e.jsx(I,{message:y.nik,className:"mt-2"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"nama",children:"Nama Balita/Anak"}),e.jsx(N,{id:"nama",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nama",value:i.nama,onChange:a=>u({...i,nama:a.target.value}),disabled:p,placeholder:"Nama Balita/Anak"}),e.jsx(I,{message:y.nama,className:"mt-2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"col-span-1 grid gap-2",children:[e.jsx(b,{htmlFor:"tempat_lahir",children:"Tempat"}),e.jsx(N,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:i.tempat_lahir,onChange:a=>u({...i,tempat_lahir:a.target.value}),disabled:p,placeholder:"tempat_lahir......."}),e.jsx(I,{message:y.tempat_lahir})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(b,{htmlFor:"tanggal_lahir",children:"Tanggal Lahir"}),e.jsx(N,{id:"tanggal_lahir",type:"date",required:!0,max:ue,tabIndex:2,autoComplete:"tanggal_lahir",value:i.tanggal_lahir,onChange:a=>le(a),disabled:p,placeholder:"tanggal lahir......."}),e.jsx(I,{message:y.tanggal_lahir})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:f.map((a,s)=>{var l,r,n,o;const t=((r=(l=i.kriteria)==null?void 0:l[s])==null?void 0:r.nilai)??"";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-sm font-medium text-gray-700",children:a.nama.charAt(0).toUpperCase()+a.nama.slice(1)}),a.nama.toLowerCase()==="jenis kelamin"?e.jsxs(Se,{value:((o=(n=i.kriteria)==null?void 0:n[s])==null?void 0:o.nilai)||"",required:!0,onValueChange:m=>{u(x=>{var j;return{...x,jenis_kelamin:m,kriteria:(j=x.kriteria)==null?void 0:j.map((k,_)=>_===s?{...k,nilai:m}:k)}})},children:[e.jsx(_e,{className:"w-full",children:e.jsx(Be,{placeholder:"Select Jenis Kelamin"})}),e.jsx(Ie,{children:["Laki-laki","Perempuan"].map((m,x)=>e.jsx(Te,{value:m,children:m},x))})]}):e.jsx(N,{type:"text",name:`kriteria.${s}`,value:t,onChange:re,placeholder:`Enter ${a.nama}`,disabled:p,readOnly:a.nama.toLowerCase().includes("imt")||a.nama.toLowerCase().includes("umur"),required:!0})]},s)})}),e.jsx("div",{className:"grid gap-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{className:"",children:[e.jsx(b,{htmlFor:"gejala",children:"Gejala"}),e.jsx(Fe,{id:"gejala",name:"gejala",value:fe,onChange:be,closeMenuOnSelect:!1,components:je,isMulti:!0,options:T,className:"react-select-container",classNamePrefix:"react-select",tabIndex:4,placeholder:"Pilih gejala..."})]}),e.jsx("div",{className:"",children:e.jsx("ul",{children:ae.map(a=>e.jsx("li",{className:"mb-2",children:e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4",children:[e.jsx("h3",{className:"mb-1 font-semibold",children:a.nama}),e.jsx("p",{className:"text-sm text-gray-600",children:a.deskripsi})]})},a.id))})})]})}),e.jsx("div",{className:"flex w-full flex-wrap gap-3 pt-4",children:e.jsxs(M,{type:"submit",disabled:G||!v||Q,className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",children:[G?e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Proses"]})})]})})}),e.jsxs(ye,{open:z,onOpenChange:$,children:[e.jsx(we,{}),e.jsxs(ve,{className:"h-auto max-w-7xl overflow-y-auto",children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center gap-3 text-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500/10",children:e.jsx($e,{className:`h-4 w-4 ${(c==null?void 0:c.label)=="Baik"?"text-green-500":"text-red-500"}`})}),e.jsx("span",{className:"text-lg font-medium",children:"Hasil rekomendasi sayuran"})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama Anak"}),e.jsx("p",{className:"text-sm font-medium",children:i.nama})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Tanggal Lahir"}),e.jsx("p",{className:"text-sm font-medium",children:i.tanggal_lahir})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Usia"}),e.jsx("p",{className:"text-sm font-medium",children:ge(i.tanggal_lahir)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground "+he,children:"status IMT"}),e.jsx("p",{className:`h-auto w-max flex-shrink-0 rounded-full px-2 ${(c==null?void 0:c.label)==="Buruk"?"bg-red-500":(c==null?void 0:c.label)==="Cukup"?"bg-yellow-500":(c==null?void 0:c.label)==="Baik"?"bg-green-500":"bg-blue-500"}`,children:c==null?void 0:c.label})]})]}),e.jsx(Ee,{data:Z}),e.jsxs(M,{type:"button",variant:"default",size:"sm",className:"w-full",disabled:p,onClick:K,children:[p?e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Simpan"]})]})]})]})]})};export{Xe as C};

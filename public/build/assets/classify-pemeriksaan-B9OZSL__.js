import{K as he,r as m,j as e,b as q}from"./app-3gSJrcYZ.js";import{D as xe,f as pe,a as fe,c as je,d as Ne}from"./dialog-BBLPHtgk.js";import{I as w}from"./input-BpRJn_e0.js";import{L as N}from"./label-DRUE_Rhl.js";import{S as be,a as ye,b as we,c as ke,f as ve}from"./select-Da5jRQo7.js";import{T as Se}from"./use-mobile-navigation-Bj26Qtq-.js";import{D as Ce}from"./decision-tree-model-DRgtkk-G.js";import{i as De,S as Be}from"./react-select-animated.esm-C2LwwCqI.js";import{I as T}from"./input-error-DBS-SoJN.js";import{T as Te}from"./table-dataset-sayuran-Isaa-Lfn.js";import{a as Ie,B as A}from"./proxy-DPZ7lxn4.js";import{L as Y}from"./loader-circle-CYQ1Duwr.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M2 22c1.25-.987 2.27-1.975 3.9-2.2a5.56 5.56 0 0 1 3.8 1.5 4 4 0 0 0 6.187-2.353 3.5 3.5 0 0 0 3.69-5.116A3.5 3.5 0 0 0 20.95 8 3.5 3.5 0 1 0 16 3.05a3.5 3.5 0 0 0-5.831 1.373 3.5 3.5 0 0 0-5.116 3.69 4 4 0 0 0-2.348 6.155C3.499 15.42 4.409 16.712 4.2 18.1 3.926 19.743 3.014 20.732 2 22",key:"1134nt"}],["path",{d:"M2 22 17 7",key:"1q7jp2"}]],Me=Ie("LeafyGreen",Le),Re=({data:i,setData:g,processing:p,errors:k,kriteria:f,setResult:L,setFeature:M,submit:U})=>{const{auth:V}=he().props,[_,v]=m.useState(!1),[_e,H]=m.useState(null),[S]=m.useState(new Ce),[R,F]=m.useState(!1),[o,z]=m.useState(null),[J,K]=m.useState(!1),E=new Date,[I,Q]=m.useState([]),[W,X]=m.useState([]),[C,h]=m.useState({title:"",show:!1,message:"",type:"success"}),Z=a=>{const{value:s}=a.target,t=f.findIndex(l=>l.nama.toLowerCase().includes("umur"));g(l=>{var n;const r=ne(s);return{...l,tanggal_lahir:s,kriteria:(n=l.kriteria)==null?void 0:n.map((u,c)=>c===t?{...u,nilai:r.toString()}:u)}})},ee=m.useCallback(a=>{const{name:s,value:t}=a.target,[l,r]=s.split("."),n=Number(r);l==="kriteria"?(t===""||/^-?\d*\.?\d*$/.test(t))&&g(u=>{var D,G,$;const c=(D=u.kriteria)==null?void 0:D.map((d,B)=>B===n?{...d,nilai:t}:d),x=f.findIndex(d=>d.nama.includes("BB")),j=f.findIndex(d=>d.nama.includes("TB")),y=f.findIndex(d=>d.nama.toLowerCase().includes("imt"));if((n===x||n===j)&&y!==-1){const d=Number(n===x?t:((G=c==null?void 0:c[x])==null?void 0:G.nilai)??0),B=Number(n===j?t:(($=c==null?void 0:c[j])==null?void 0:$.nilai)??0);if(d>0&&B>0)return{...u,kriteria:c==null?void 0:c.map((O,ge)=>ge===y?{...O,nilai:oe(d,B)}:O)}}return{...u,kriteria:c}}):g(u=>({...u,[s]:t}))},[f,g]),ae=async()=>{try{const a=await q.get(route("api.get.gejala"));if(a.status!==200)throw new Error("Failed to fetch gejala");const s=await a.data;Q(s.map(t=>({value:t.nama,label:t.nama})))}catch(a){return console.error(a),h({title:"Error",show:!0,message:a.message,type:"error"}),null}};m.useEffect(()=>{const a=async()=>{v(!0);try{const s=await S.fetchAndProcessData();await S.loadModel(),H(s)}catch(s){h({title:"Error",show:!0,message:`${s.message}, Lakukan training pada halaman decision Tree sebelum masuk Pemeriksaan Nutrisi Anak`,type:"error"}),K(!0)}finally{v(!1)}};ae(),a()},[]);const te=async a=>{var s;a.preventDefault(),v(!0);try{const t=(s=i.kriteria)==null?void 0:s.map(l=>{const r=l.nilai;(r==null||r===""||i.rme==="")&&h({title:"Error",show:!0,message:"Nilai No.RME, jenis kelamin, usia,  BB, TB, IMT Tidak Boleh Kosong ",type:"error"});const n=String(r).toLowerCase();return n==="laki-laki"?0:n==="perempuan"?1:!isNaN(parseFloat(r))&&isFinite(r)?parseFloat(r):r});if(i.nik===""||i.rme===""&&V.role=="admin"||i.nama===""||i.orang_tua_id===""||i.tempat_lahir==="")h({title:"Error",show:!0,message:"NIK, RME, Nama, Orang Tua, Tempat Lahir Tidak Boleh Kosong ",type:"error"});else{const l=await S.predict([t??[]]);l.error?h({title:"Hasil Prediksi",show:!0,message:l.error,type:"success"}):(z(l),M&&M(i.kriteria),l.label!==void 0&&l.label!==null&&(g({...i,label:l.label.toString()??"tidak dikenali"}),L&&L(l),se()))}}catch(t){console.error(t),h({title:"Hasil Prediksi",show:!0,message:t,type:"success"})}finally{v(!1)}},se=()=>{F(!0)},P=new Date(E);P.setFullYear(E.getFullYear()-1);const le=P.toISOString().split("T")[0];function re(a){const s=new Date(a),t=new Date;let l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth(),n=t.getDate()-s.getDate();return n<0&&(r--,n+=new Date(t.getFullYear(),t.getMonth(),0).getDate()),r<0&&(l--,r+=12),`${l} tahun, ${r} bulan, ${n} hari`}function ne(a){const s=new Date(a),t=new Date;let l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth(),n=t.getDate()-s.getDate(),u=l*12+r;return n<0&&(u-=1),u.toString()}const ie=m.useMemo(()=>{if(!o)return"";switch(o.label){case"Buruk":return"bg-red-100 border-red-300 text-red-800";case"Cukup":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"Baik":return"bg-green-100 border-green-300 text-green-800";default:return"bg-blue-100 border-blue-300 text-blue-800"}},[o]),oe=(a,s)=>{const t=s/100;return(a/(t*t)).toFixed(3)},[b,ce]=m.useState([]),me=m.useMemo(()=>I.filter(a=>b.includes(a.value)),[I,b]),ue=De(),de=a=>{const s=a?a.map(t=>t.value):[];ce(s)};return m.useEffect(()=>{const a=b.join(", ");b.length>0&&(async(t,l)=>{try{const r=await q.get(route("api.get.dataset.sayuran",{status:t,gejala:l}));if(r.status!==200)throw new Error("Failed to fetch dataset");const n=await r.data;X(n),g({...i,rekomendasi:n,gejala:l})}catch(r){return console.error(r),h({title:"Error Gejala",show:!0,message:r.message,type:"error"}),null}})((o==null?void 0:o.label)??"",a)},[b]),e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[e.jsx(Se,{open:C.show,onOpenChange:()=>h(a=>({...a,show:!1})),title:C.title,description:C.message,duration:1e4,variant:C.type}),e.jsx("div",{className:"grid grid-cols-1 overflow-hidden rounded-xl border border-gray-100 bg-white shadow-sm",children:e.jsx("div",{className:"p-6 ring-1 md:p-8",children:e.jsxs("form",{onSubmit:a=>te(a),className:"space-y-6",children:[e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"nik",children:"NIK"}),e.jsx(w,{id:"nik",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nik",value:i.nik,onChange:a=>g({...i,nik:a.target.value}),disabled:p,placeholder:"Masukkan Nik Balita"}),e.jsx(T,{message:k.nik,className:"mt-2"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"nama",children:"Nama Balita/Anak"}),e.jsx(w,{id:"nama",type:"text",required:!0,autoFocus:!0,tabIndex:1,autoComplete:"nama",value:i.nama,onChange:a=>g({...i,nama:a.target.value}),disabled:p,placeholder:"Nama Balita/Anak"}),e.jsx(T,{message:k.nama,className:"mt-2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"col-span-1 grid gap-2",children:[e.jsx(N,{htmlFor:"tempat_lahir",children:"Tempat"}),e.jsx(w,{id:"tempat_lahir",type:"text",required:!0,tabIndex:2,autoComplete:"tempat_lahir",value:i.tempat_lahir,onChange:a=>g({...i,tempat_lahir:a.target.value}),disabled:p,placeholder:"tempat_lahir......."}),e.jsx(T,{message:k.tempat_lahir})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(N,{htmlFor:"tanggal_lahir",children:"Tanggal Lahir"}),e.jsx(w,{id:"tanggal_lahir",type:"date",required:!0,max:le,tabIndex:2,autoComplete:"tanggal_lahir",value:i.tanggal_lahir,onChange:a=>Z(a),disabled:p,placeholder:"tanggal lahir......."}),e.jsx(T,{message:k.tanggal_lahir})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:f.map((a,s)=>{var l,r,n,u;const t=((r=(l=i.kriteria)==null?void 0:l[s])==null?void 0:r.nilai)??"";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-sm font-medium text-gray-700",children:a.nama.charAt(0).toUpperCase()+a.nama.slice(1)}),a.nama.toLowerCase()==="jenis kelamin"?e.jsxs(be,{value:((u=(n=i.kriteria)==null?void 0:n[s])==null?void 0:u.nilai)||"",required:!0,onValueChange:c=>{g(x=>{var j;return{...x,jenis_kelamin:c,kriteria:(j=x.kriteria)==null?void 0:j.map((y,D)=>D===s?{...y,nilai:c}:y)}})},children:[e.jsx(ye,{className:"w-full",children:e.jsx(we,{placeholder:"Select Jenis Kelamin"})}),e.jsx(ke,{children:["Laki-laki","Perempuan"].map((c,x)=>e.jsx(ve,{value:c,children:c},x))})]}):e.jsx(w,{type:"text",name:`kriteria.${s}`,value:t,onChange:ee,placeholder:`Enter ${a.nama}`,disabled:p,readOnly:a.nama.toLowerCase().includes("imt")||a.nama.toLowerCase().includes("umur"),required:!0})]},s)})}),e.jsx("div",{className:"flex flex-wrap gap-3 pt-4",children:e.jsxs(A,{type:"submit",disabled:_||!S||J,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",children:[_?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Mulai Pemeriksaan Nutrisi"]})})]})})}),e.jsxs(xe,{open:R,onOpenChange:F,children:[e.jsx(pe,{}),e.jsxs(fe,{className:"h-screen max-w-7xl overflow-y-auto",children:[e.jsx(je,{children:e.jsxs("div",{className:"flex items-center gap-3 text-foreground",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500/10",children:e.jsx(Me,{className:`h-4 w-4 ${(o==null?void 0:o.label)=="Baik"?"text-green-500":"text-red-500"}`})}),e.jsx("span",{className:"text-lg font-medium",children:"Hasil Pemeriksaan Nutrisi"})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama Anak"}),e.jsx("p",{className:"text-sm font-medium",children:i.nama})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Tanggal Lahir"}),e.jsx("p",{className:"text-sm font-medium",children:i.tanggal_lahir})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Usia"}),e.jsx("p",{className:"text-sm font-medium",children:re(i.tanggal_lahir)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground "+ie,children:"Status Nutrisi"}),e.jsx("p",{className:`h-auto w-max flex-shrink-0 rounded-full px-2 ${(o==null?void 0:o.label)==="Buruk"?"bg-red-500":(o==null?void 0:o.label)==="Cukup"?"bg-yellow-500":(o==null?void 0:o.label)==="Baik"?"bg-green-500":"bg-blue-500"}`,children:o==null?void 0:o.label})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"gejala",children:"Gejala"}),e.jsx(Be,{id:"gejala",name:"gejala",value:me,onChange:de,closeMenuOnSelect:!1,components:ue,isMulti:!0,options:I,className:"react-select-container",classNamePrefix:"react-select",tabIndex:4,placeholder:"Pilih gejala..."})]})]}),e.jsx("div",{className:"max-w-auto p-2",children:e.jsx(Te,{data:W})}),e.jsx(Ne,{className:"mt-6",children:e.jsxs(A,{type:"button",variant:"default",size:"sm",className:"w-full",disabled:p,onClick:U,children:[p?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Simpan"]})})]})]})]})};export{Re as C};
